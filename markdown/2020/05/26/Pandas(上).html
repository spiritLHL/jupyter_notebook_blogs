<!DOCTYPE html>
<html lang="en"><head>
  <meta name="msvalidate.01" content="FC9B6B8BEB3D3B56844ADA69766DBB24" />
  <!-- Clarity tracking code for https://www.spiritlhl.top/jupyter_notebook_blogs/ --><script>    (function(c,l,a,r,i,t,y){        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);    })(window, document, "clarity", "script", "5qmmjq0760");</script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Pandas (上) | SpiritLHL’s Python blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Pandas (上)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Pandas (上)" />
<meta property="og:description" content="Pandas (上)" />
<link rel="canonical" href="https://spiritlhl.github.io/jupyter_notebook_blogs//jupyter_notebook_blogs/markdown/2020/05/26/Pandas(%E4%B8%8A).html" />
<meta property="og:url" content="https://spiritlhl.github.io/jupyter_notebook_blogs//jupyter_notebook_blogs/markdown/2020/05/26/Pandas(%E4%B8%8A).html" />
<meta property="og:site_name" content="SpiritLHL’s Python blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-26T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://spiritlhl.github.io/jupyter_notebook_blogs//jupyter_notebook_blogs/markdown/2020/05/26/Pandas(%E4%B8%8A).html","@type":"BlogPosting","headline":"Pandas (上)","dateModified":"2020-05-26T00:00:00-05:00","datePublished":"2020-05-26T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://spiritlhl.github.io/jupyter_notebook_blogs//jupyter_notebook_blogs/markdown/2020/05/26/Pandas(%E4%B8%8A).html"},"description":"Pandas (上)","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/jupyter_notebook_blogs/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://spiritlhl.github.io/jupyter_notebook_blogs//jupyter_notebook_blogs/feed.xml" title="SpiritLHL's Python blog" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','G-3TD0N5Q1SC','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/jupyter_notebook_blogs/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" /><script src="https://hypothes.is/embed.js" async></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/jupyter_notebook_blogs/">SpiritLHL&#39;s Python blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/jupyter_notebook_blogs/about/">About Me</a><a class="page-link" href="/jupyter_notebook_blogs/search/">Search</a><a class="page-link" href="/jupyter_notebook_blogs/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <meta name="msvalidate.01" content="FC9B6B8BEB3D3B56844ADA69766DBB24" />
    <h1 class="post-title p-name" itemprop="name headline">Pandas (上)</h1><p class="page-description">Pandas (上)</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-05-26T00:00:00-05:00" itemprop="datePublished">
        May 26, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      19 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/jupyter_notebook_blogs/categories/#markdown">markdown</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <script data-ad-client="ca-pub-8663941481627036" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <h2 id="前言">前言</h2>

<h2 id="本篇鸣谢-马川-燕大-的增删整理-王圣元-原创文章与原文不同之处包含我的学习记录">本篇鸣谢 马川-燕大 的增删整理， 王圣元 ——<a href="https://mp.weixin.qq.com/s/Fo-UIGnsoU2nBVLxSw_nVw">原创文章</a>，与原文不同之处包含我的学习记录。</h2>

<p>匹配Jupyter Notebook的ipynb文档链接下载地址如下</p>

<p><a href="https://spiritlhl.lanzous.com/id0v4tc"><strong>源文档及相关文件</strong></a></p>

<p><img src="https://pic.liesio.com/2020/05/12/84bc3c30041cf.png" alt="知识框架导图" /></p>

<h2 id="0-引言">0 引言</h2>

<p>Pandas 是 Python 为解决数据分析而创建的，详情看官网 <a href="https://pandas.pydata.org/">https://pandas.pydata.org/</a>。 在使用 pandas 之前，需要引进它，语法如下：</p>

<blockquote>
  <p>import pandas</p>
</blockquote>

<p>这样就可以用 pandas 里面所有的内置方法 (build-in methods) 了，比如创建一维的 Series 和二维的 DataFrame。</p>

<blockquote>
  <p>pandas.Series()</p>
</blockquote>

<blockquote>
  <p>pandas.DataFrame()</p>
</blockquote>

<p>但是每次写 pandas 字数有点多，通常给 pandas 起个别名 pd，用以下语法，这样所有出现 pandas 的地方都可以用 pd 替代。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span><span class="c1">#本篇使用的是0.25.1版本的pandas
</span></code></pre></div></div>

<p>Pandas 里面的数据结构是「多维数据表」，学习它可以类比这 NumPy 里的「多维数组」。1/2 维的「多维数据表」分别叫做 Series (系列)和 DataFrame (数据帧)，与1/2 维的「多维数组」的类比关系如下。</p>

<p><img src="https://pic.liesio.com/2020/05/26/4e360426d986a.png" alt="" /></p>

<p>由于「系列」、「数据帧」这些直译过来的中文名词听起来有些奇怪，在本帖还是直接用 Series和 DataFrame。</p>

<p>对比 NumPy (np) 和 Pandas (pd) 每个维度下的数据结构，不难看出</p>

<p><b><font color="red">pd 多维数据表 </font>= <font color="blue">np 多维数组</font> + <font color="green">描述</font></b></p>

<p>其中
<b></b></p>
<ul>
  <li>
    <font color="red">Series</font>
    <p>= <font color="blue">1darray</font> + <font color="green">index</font></p>
  </li>
  <li>
    <font color="red">DataFrame</font>
    <p>= <font color="blue">2darray</font> + <font color="green">index</font> + <font color="green">columns</font>
&lt;/b&gt;</p>
  </li>
</ul>

<p>每个维度上的「索引」使得「多维数据表」比「多维数组」涵盖更多的信息，如下图，左边的 2d array 仅仅储存了一组数值 (具体代表什么意思却不知道)，而右边的 DataFrame 一看就知道这是平安银行和茅台从 2018-1-3 到 2019-1-3 的价格。</p>

<p><img src="https://pic.liesio.com/2020/05/26/5df7eecc241c6.png" alt="" /></p>

<p>和学习 numpy 一样，学习 pandas 还是遵循的 Python 里「万物皆对象」的原则，既然把数据表当对象，就得按着<strong>数据表的创建、数据表的存载、数据表的获取、数据表的合并和连接、数据表的重塑和透视、和数据表的分组和整合</strong>来盘一盘 Pandas。</p>

<p><strong>提纲：</strong></p>

<p><img src="https://pic.liesio.com/2020/05/26/afca006e38cc6.png" alt="" /></p>

<p>由于篇幅原因，Pandas 系列分两贴，上贴讲前三节的内容，下帖讲后三节的内容。</p>

<h2 id="1-数据表的创建">1 数据表的创建</h2>

<p>数据表有两大类型</p>

<ul>
  <li>
    <p><strong>Series</strong>: 一维数据，类似于 python 中的基本数据的 list 或 NumPy 中的 1D array。Pandas 里最基本的数据结构</p>
  </li>
  <li>
    <p><strong>DataFrame</strong>: 二维数据，类似于 R 中的 data.frame 或 Matlab 中的 Tables。DataFrame 是 Series 的容器</p>
  </li>
</ul>

<font color="red"><b>知识点</b></font>

<p>最常见的数据类型是二维的 DataFrame，其中</p>

<ul>
  <li>
    <p>每行代表一个示例 (instance)</p>
  </li>
  <li>
    <p>每列代表一个特征 (feature)</p>
  </li>
</ul>

<p>DataFrame 可理解成是 Series 的容器，每一列都是一个 Series，或者 Series 是只有一列的 DataFrame。</p>

<p>接下来用代码来创建 pandas 数据表：</p>

<h4 id="一维-series">一维 Series</h4>

<p>创建 Series 只需用下面一行代码</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pd.Series( x, index=idx )
</code></pre></div></div>

<p>其中 x 可以是</p>

<ol>
  <li>
    <p>列表 (list)</p>
  </li>
  <li>
    <p>numpy 数组 (ndarray)</p>
  </li>
  <li>
    <p>字典 (dict)</p>
  </li>
</ol>

<p>回顾Python编程基础中函数的定义，那么</p>

<ul>
  <li>
    <p>x 是位置参数</p>
  </li>
  <li>
    <p>index 是默认参数，默认值为 idx = range(0, len(x))</p>
  </li>
</ul>

<font color="red"><b>用列表</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">27.2</span><span class="p">,</span> <span class="mf">27.65</span><span class="p">,</span> <span class="mf">27.70</span><span class="p">,</span> <span class="mi">28</span><span class="p">])</span>
<span class="n">s</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0    27.20
1    27.65
2    27.70
3    28.00
dtype: float64
</code></pre></div></div>

<p>打印出来并不仅仅是列表里面的浮点数，每个浮点数前面还有一个索引，在本例中是 0, 1, 2, 3。</p>

<p>因此在创建 Series 时，如果不显性设定 index，那么 Python 给定一个默认从 0 到 N-1 的值，其中 N 是 x 的长度。</p>

<p>Series s 也是一个对象，用 dir(s) 可看出关于 Series 所有的属性和内置函数，其中最重要的是</p>

<ul>
  <li>
    <p>用 s.values 打印 s 中的元素</p>
  </li>
  <li>
    <p>用 s.index 打印 s 中的元素对应的索引</p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">.</span><span class="n">values</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([27.2 , 27.65, 27.7 , 28.  ])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">.</span><span class="n">index</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RangeIndex(start=0, stop=4, step=1)
</code></pre></div></div>

<p>不难发现，以上创建的 Series 和 numpy 数组比多了「索引」，但这种 0,1,2,3 的索引是在没有什么描述意义。实际上定义的 s 是海底捞在 2019 年 4 月 1 日到 2019 年 4 月 4 日的股价，那么用日期来当索引是不是更好些？</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">date_range</span><span class="p">(</span><span class="s">'20190401'</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span> <span class="p">[</span><span class="mf">27.2</span><span class="p">,</span> <span class="mf">27.65</span><span class="p">,</span> <span class="mf">27.70</span><span class="p">,</span> <span class="mi">28</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span> <span class="p">)</span>
<span class="n">s2</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-04-01    27.20
2019-04-02    27.65
2019-04-03    27.70
2019-04-04    28.00
Freq: D, dtype: float64
</code></pre></div></div>

<h1 id="pandasdate_rangestartnone-endnone-periodsnone-freqd-tznone-normalizefalse-namenone-closednone-kwargs">pandas.date_range(start=None, end=None, periods=None, freq=’D’, tz=None, normalize=False, name=None, closed=None, **kwargs)</h1>

<h1 id="该函数主要用于生成一个固定频率的时间索引在调用构造方法时必须指定startendperiods中的两个参数值否则报错">该函数主要用于生成一个固定频率的时间索引，在调用构造方法时，必须指定start、end、periods中的两个参数值，否则报错。</h1>

<h1 id="主要参数说明">主要参数说明：</h1>

<ul>
  <li>
    <p>periods：固定时期，取值为整数或None</p>
  </li>
  <li>
    <p>freq：日期偏移量，取值为string或DateOffset，默认为’D’</p>
  </li>
  <li>
    <p>normalize：若参数为True表示将start、end参数值正则化到午夜时间戳</p>
  </li>
  <li>
    <p>name：生成时间索引对象的名称，取值为string或None</p>
  </li>
  <li>
    <p>closed：可以理解成在closed=None情况下返回的结果中，若closed=‘left’表示在返回的结果基础上，再取左开右闭的结果，若closed=’right’表示在返回的结果基础上，再取做闭右开的结果</p>
  </li>
</ul>

<p>显然，s2 比 s 包含的信息更多，这是 s2 的索引是一组日期对象，数据类型是 datetime64，频率是 D (天)。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s2</span><span class="p">.</span><span class="n">index</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DatetimeIndex(['2019-04-01', '2019-04-02', '2019-04-03', '2019-04-04'], dtype='datetime64[ns]', freq='D')
</code></pre></div></div>

<p>甚至还可以给 s2 命名，就叫海底捞股价如何？</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s2</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'海底捞股价'</span>
<span class="n">s2</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-04-01    27.20
2019-04-02    27.65
2019-04-03    27.70
2019-04-04    28.00
Freq: D, Name: 海底捞股价, dtype: float64
</code></pre></div></div>

<font color="red"><b>用 numpy 数组</b></font>

<p>除了用列表，还可以用 numpy 数组来生成 Series。在下例中，加入缺失值 np.nan，并分析一下 Series 中另外 5 个属性或内置函数的用法：</p>

<ul>
  <li>
    <p>len: s 里的元素个数</p>
  </li>
  <li>
    <p>shape: s 的形状 (用元组表示)</p>
  </li>
  <li>
    <p>count: s 里不含 nan 的元素个数</p>
  </li>
  <li>
    <p>unique: 返回 s 里不重复的元素</p>
  </li>
  <li>
    <p>value_counts: 统计 s 里非 nan 元素的出现次数</p>
  </li>
</ul>

<p>对照上面函数的用法，下面的输出一看就懂了吧。</p>

<p>空值的产生只有np.nan()</p>

<p>总结一下：</p>

<p>np.nan不是一个“空”对象，用 i is None判断是False；
对某个值是否为空值进行判断，只能用np.isnan(i)函数，万万不可用 i == np.nan()来做，否则你会死的很惨的，因为空值并不能用判断相等的“==”正确识别（上例前两条）；</p>

<p>np.nan非空对象，其类型为基本数据类型float（是不是很神奇，我也不知道为什么要这样设计）</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">27.2</span><span class="p">,</span> <span class="mf">27.65</span><span class="p">,</span> <span class="mf">27.70</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">])</span> <span class="p">)</span>
<span class="k">print</span><span class="p">(</span> <span class="s">'The length is'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">)</span>
<span class="k">print</span><span class="p">(</span> <span class="s">'The shape is'</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">shape</span> <span class="p">)</span>
<span class="k">print</span><span class="p">(</span> <span class="s">'The count is'</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">count</span><span class="p">()</span> <span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The length is 6
The shape is (6,)
The count is 5
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">.</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([27.2 , 27.65, 27.7 , 28.  ,   nan])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>28.00    2
27.70    1
27.65    1
27.20    1
dtype: int64
</code></pre></div></div>

<font color="red"><b>用字典</b></font>

<p>创建 Series 还可以用字典。字典的「键值对」的「键」自动变成了 Series 的索引 (index)，而「值」自动变成了Series 的值 (values)。代码如下 (下列用 name 参数来对 s3 命名)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'BABA'</span><span class="p">:</span> <span class="mf">187.07</span><span class="p">,</span> <span class="s">'PDD'</span><span class="p">:</span> <span class="mf">21.83</span><span class="p">,</span> <span class="s">'JD'</span><span class="p">:</span> <span class="mf">30.79</span><span class="p">,</span> <span class="s">'BIDU'</span><span class="p">:</span> <span class="mf">184.77</span> <span class="p">}</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'中概股'</span><span class="p">)</span>
<span class="n">s3</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'股票代号'</span>
<span class="n">s3</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>股票代号
BABA    187.07
PDD      21.83
JD       30.79
BIDU    184.77
Name: 中概股, dtype: float64
</code></pre></div></div>

<p>给 s3 起名中概股是因为阿里巴巴 (BABA)、拼多多 (PDD)、京东 (JD) 和百度 (BIDU) 都是中国公司但在美国上市的。此外还可以给 index 命名为 ‘股票代号’。</p>

<p>现在假设这里的股票代号为</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stock</span> <span class="o">=</span> <span class="p">[</span><span class="s">'FB'</span><span class="p">,</span> <span class="s">'BABA'</span><span class="p">,</span> <span class="s">'PDD'</span><span class="p">,</span> <span class="s">'JD'</span><span class="p">]</span>
<span class="n">s4</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span> <span class="n">s3</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">stock</span> <span class="p">)</span>
<span class="n">s4</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FB         NaN
BABA    187.07
PDD      21.83
JD       30.79
Name: 中概股, dtype: float64
</code></pre></div></div>

<p>代号里多加了脸书 (FB)，而 sdata 字典中没有 FB 这个键，因此生成的 s4 在 FB 索引下对应的值为 NaN。再者，代号里没有百度 (BIDU)，因此 s4 里面没有 BIDU 对应的值 (即便 sdata 里面有)。</p>

<p>当两个 Series 进行某种操作时，比如相加，Python 会自动对齐不同 Series 的 index，如下面代码所示：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s3</span> <span class="o">+</span> <span class="n">s4</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BABA    374.14
BIDU       NaN
FB         NaN
JD       61.58
PDD      43.66
Name: 中概股, dtype: float64
</code></pre></div></div>

<p>Series 是 Pandas 里面最基本的数据结构，但是对应每个索引只有一个元素 (比如一个日期对应一个股价)，因此 Series 处理不了每个索引对应多个元素 (比如一个日期对应一个开盘价、收盘价、交易量等等)。而 DataFrame 可以解决这个问题。</p>

<h4 id="二维-dataframe">二维 DataFrame</h4>

<p>创建 DataFrame 只需用下面一行代码</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pd.DataFrame( x, index=idx, columns=col )
</code></pre></div></div>

<p>其中 x 可以是</p>

<ol>
  <li>
    <p>二维列表 (list)</p>
  </li>
  <li>
    <p>二维 numpy 数组 (ndarray)</p>
  </li>
  <li>
    <p>字典 (dict)，其值是一维列表、numpy 数组或 Series</p>
  </li>
  <li>
    <p>另外一个 DataFrame</p>
  </li>
</ol>

<p>回顾Python编程基础中函数的定义，那么</p>

<ul>
  <li>
    <p>x 是位置参数</p>
  </li>
  <li>
    <p>index 是默认参数，默认值为 idx = range(0, x.shape[0]),行索引</p>
  </li>
  <li>
    <p>columns 是默认参数，默认值为 col = range(0, x.shape[1])，列索引</p>
  </li>
</ul>

<font color="red"><b>用列表或 numpy 数组</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># df1 = pd.DataFrame( [[1, 2, 3], [4, 5, 6]] )
</span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span> <span class="p">)</span>
<span class="n">df1</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>5</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>

<p>在创建 DataFrame 时，如果不显性设定 index 和 columns 时，那么Python 给它们默认值，其中</p>

<ul>
  <li>
    <p>index = 0 到 r-1，r 是 x 的行数</p>
  </li>
  <li>
    <p>colmns = 0 到 c-1，c 是 x 的列数</p>
  </li>
</ul>

<font color="red"><b>用对象为列表的字典</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">symbol</span> <span class="o">=</span> <span class="p">[</span><span class="s">'BABA'</span><span class="p">,</span> <span class="s">'JD'</span><span class="p">,</span> <span class="s">'AAPL'</span><span class="p">,</span> <span class="s">'MS'</span><span class="p">,</span> <span class="s">'GS'</span><span class="p">,</span> <span class="s">'WMT'</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'行业'</span><span class="p">:</span> <span class="p">[</span><span class="s">'电商'</span><span class="p">,</span> <span class="s">'电商'</span><span class="p">,</span> <span class="s">'科技'</span><span class="p">,</span> <span class="s">'金融'</span><span class="p">,</span> <span class="s">'金融'</span><span class="p">,</span> <span class="s">'零售'</span><span class="p">],</span>
        <span class="s">'价格'</span><span class="p">:</span> <span class="p">[</span><span class="mf">176.92</span><span class="p">,</span> <span class="mf">25.95</span><span class="p">,</span> <span class="mf">172.97</span><span class="p">,</span> <span class="mf">41.79</span><span class="p">,</span> <span class="mf">196.00</span><span class="p">,</span> <span class="mf">99.55</span><span class="p">],</span>
        <span class="s">'交易量'</span><span class="p">:</span> <span class="p">[</span><span class="mi">16175610</span><span class="p">,</span> <span class="mi">27113291</span><span class="p">,</span> <span class="mi">18913154</span><span class="p">,</span> <span class="mi">10132145</span><span class="p">,</span> <span class="mi">2626634</span><span class="p">,</span> <span class="mi">8086946</span><span class="p">],</span>
        <span class="s">'雇员'</span><span class="p">:</span> <span class="p">[</span><span class="mi">101550</span><span class="p">,</span> <span class="mi">175336</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">60348</span><span class="p">,</span> <span class="mi">36600</span><span class="p">,</span> <span class="mi">2200000</span><span class="p">]}</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">symbol</span> <span class="p">)</span>
<span class="n">df2</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s">'美股'</span>
<span class="n">df2</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'代号'</span>
<span class="n">df2</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>零售</td>
      <td>99.55</td>
      <td>8086946</td>
      <td>2200000</td>
    </tr>
  </tbody>
</table>
</div>

<p>字典的「键值对」的「键」自动变成了 DataFrame 的栏 (columns)，而「值」自动变成了 DataFrame 的值 (values)，而其索引 (index) 需要另外定义。</p>

<p>分别来看 df2 的 values, columns 和 index。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span><span class="p">.</span><span class="n">values</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([['电商', 176.92, 16175610, 101550],
       ['电商', 25.95, 27113291, 175336],
       ['科技', 172.97, 18913154, 100000],
       ['金融', 41.79, 10132145, 60348],
       ['金融', 196.0, 2626634, 36600],
       ['零售', 99.55, 8086946, 2200000]], dtype=object)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span><span class="p">.</span><span class="n">columns</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Index(['行业', '价格', '交易量', '雇员'], dtype='object')
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span><span class="p">.</span><span class="n">index</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Index(['BABA', 'JD', 'AAPL', 'MS', 'GS', 'WMT'], dtype='object', name='代号')
</code></pre></div></div>

<h4 id="a-查看-dataframe">A 查看 DataFrame</h4>

<p>这里可以从头或从尾部查看 DataFrame 的 n 行，分别用 df2.head(n) 和 df2.tail(n)，如果没有设定 n，默认值为 <strong>5 行</strong>。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span><span class="p">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>零售</td>
      <td>99.55</td>
      <td>8086946</td>
      <td>2200000</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="b-统计-dataframe">B 统计 DataFrame</h4>

<p>可以用 df2.describe() 还可以看看 DataFrame 每栏的统计数据。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span><span class="p">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6.000000</td>
      <td>6.000000e+00</td>
      <td>6.000000e+00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>118.863333</td>
      <td>1.384130e+07</td>
      <td>4.456390e+05</td>
    </tr>
    <tr>
      <th>std</th>
      <td>73.748714</td>
      <td>8.717312e+06</td>
      <td>8.607522e+05</td>
    </tr>
    <tr>
      <th>min</th>
      <td>25.950000</td>
      <td>2.626634e+06</td>
      <td>3.660000e+04</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>56.230000</td>
      <td>8.598246e+06</td>
      <td>7.026100e+04</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>136.260000</td>
      <td>1.315388e+07</td>
      <td>1.007750e+05</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>175.932500</td>
      <td>1.822877e+07</td>
      <td>1.568895e+05</td>
    </tr>
    <tr>
      <th>max</th>
      <td>196.000000</td>
      <td>2.711329e+07</td>
      <td>2.200000e+06</td>
    </tr>
  </tbody>
</table>
</div>

<p>函数 describe() 只对「数值型变量」有用 (没有对「字符型变量」行业栏做统计)，统计量分别包括个数、均值、标准差、最小值，25-50-75 百分数值，最大值。一般做数据分析第一步会用这个表大概看看</p>

<ul>
  <li>数据是否有缺失值 (每个栏下的 count 是否相等)？</li>
</ul>

<p>*　数据是否有异常值 (最小值 min 和最大值 max 是否太极端)？</p>

<h4 id="c升维-dataframe">C　升维 DataFrame</h4>

<p>用 MultiIndex.from_tuples() 还可以赋予 DataFrame 多层索引 (实际上增加了维度，多层索引的 DataFrame 实际上是三维数据)。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">MultiIndex</span><span class="p">.</span><span class="n">from_tuples</span><span class="p">(</span> 
            <span class="p">[(</span><span class="s">'中国公司'</span><span class="p">,</span><span class="s">'BABA'</span><span class="p">),</span> <span class="p">(</span><span class="s">'中国公司'</span><span class="p">,</span><span class="s">'JD'</span><span class="p">),</span> 
             <span class="p">(</span><span class="s">'美国公司'</span><span class="p">,</span><span class="s">'AAPL'</span><span class="p">),</span> <span class="p">(</span><span class="s">'美国公司'</span><span class="p">,</span><span class="s">'MS'</span><span class="p">),</span> 
             <span class="p">(</span><span class="s">'美国公司'</span><span class="p">,</span><span class="s">'GS'</span><span class="p">),</span> <span class="p">(</span><span class="s">'美国公司'</span><span class="p">,</span><span class="s">'WMT'</span><span class="p">)]</span> <span class="p">)</span>
<span class="n">df2</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">中国公司</th>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">美国公司</th>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>零售</td>
      <td>99.55</td>
      <td>8086946</td>
      <td>2200000</td>
    </tr>
  </tbody>
</table>
</div>

<p>在 MultiIndex.from_tuples() 中传递一个「元组的列表」，每个元组，比如 (‘中国公司’, ‘BABA’)，<strong>第一个元素中国公司是第一层 index，第二个元素BABA是第二层 index</strong>。</p>

<h2 id="2-数据表的存载">2 数据表的存载</h2>

<p>本节讲数据表的「保存」和「加载」，在 NumPy 一贴已经提到过，数据的存载没什么技术含量</p>

<ul>
  <li>
    <p>保存只是为了下次再用处理好的 DataFrame</p>
  </li>
  <li>
    <p>加载可以不用重新再定义 DataFrame</p>
  </li>
</ul>

<p>DataFrame 可以被保存为 Excel, csv, SQL 和 HDF5 格式，其语句一看就懂，用 to_数据格式，具体如下：</p>

<ul>
  <li>
    <p>to_excel()</p>
  </li>
  <li>
    <p>to_csv()</p>
  </li>
  <li>
    <p>to_sql()</p>
  </li>
  <li>
    <p>to_hdf()</p>
  </li>
</ul>

<p>如果要加载某种格式的数据到 DataFrame 里，用 read_数据格式，具体如下：</p>

<ul>
  <li>
    <p>read_excel()</p>
  </li>
  <li>
    <p>read_csv()</p>
  </li>
  <li>
    <p>read_sql()</p>
  </li>
  <li>
    <p>read_hdf()</p>
  </li>
</ul>

<p>这里只用 excel 和 csv 格式举例。</p>

<font color="red"><b>Excel 格式</b></font>

<p>用 pd.to_excel 函数将 DataFrame 保存为 .xlsx 格式，并保存到 ‘Sheet1’ 中，具体写法如下：</p>

<blockquote>
  <p>pd.to_excel( ‘文件名’，’表名’ )</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]))</span>
<span class="n">df</span><span class="p">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s">'pd_excel.xlsx'</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s">'Sheet2'</span><span class="p">)</span><span class="c1">#sheet_name :字符串,默认“Sheet1”，将包含DataFrame的表的名称。
</span><span class="n">df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>5</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 pd.read_excel( ‘文件名’，’表名’ ) 即可加载该文件并存成 DataFrame 形式</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s">'pd_excel.xlsx'</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s">'Sheet2'</span><span class="p">)</span>
<span class="n">df1</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>

<font color="red"><b>csv 格式</b></font>

<p>用 pd.to_csv 函数将 DataFrame 保存为 .csv 格式，注意如果 index 没有特意设定，最后不要把 index 值存到 csv 文件中。具体写法如下：</p>

<blockquote>
  <p>pd.to_csv( ‘文件名’，index=False )</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Code'</span><span class="p">:</span> <span class="p">[</span><span class="s">'BABA'</span><span class="p">,</span> <span class="s">'00700.HK'</span><span class="p">,</span> <span class="s">'AAPL'</span><span class="p">,</span> <span class="s">'600519.SH'</span><span class="p">],</span>
        <span class="s">'Name'</span><span class="p">:</span> <span class="p">[</span><span class="s">'阿里巴巴'</span><span class="p">,</span> <span class="s">'腾讯'</span><span class="p">,</span> <span class="s">'苹果'</span><span class="p">,</span> <span class="s">'茅台'</span><span class="p">],</span>
        <span class="s">'Market'</span><span class="p">:</span> <span class="p">[</span><span class="s">'US'</span><span class="p">,</span> <span class="s">'HK'</span><span class="p">,</span> <span class="s">'US'</span><span class="p">,</span> <span class="s">'SH'</span><span class="p">],</span>
        <span class="s">'Price'</span><span class="p">:</span> <span class="p">[</span><span class="mf">185.35</span><span class="p">,</span> <span class="mf">380.2</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mf">900.2</span><span class="p">],</span>
        <span class="s">'Currency'</span><span class="p">:</span> <span class="p">[</span><span class="s">'USD'</span><span class="p">,</span> <span class="s">'HKD'</span><span class="p">,</span> <span class="s">'USD'</span><span class="p">,</span> <span class="s">'CNY'</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'pd_csv.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p>用 pd.read_csv( ‘文件名’ ) 即可加载该文件并存成 DataFrame 形式</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'pd_csv.csv'</span><span class="p">)</span>
<span class="n">df2</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Code</th>
      <th>Name</th>
      <th>Market</th>
      <th>Price</th>
      <th>Currency</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>BABA</td>
      <td>阿里巴巴</td>
      <td>US</td>
      <td>185.35</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00700.HK</td>
      <td>腾讯</td>
      <td>HK</td>
      <td>380.20</td>
      <td>HKD</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAPL</td>
      <td>苹果</td>
      <td>US</td>
      <td>197.00</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>3</th>
      <td>600519.SH</td>
      <td>茅台</td>
      <td>SH</td>
      <td>900.20</td>
      <td>CNY</td>
    </tr>
  </tbody>
</table>
</div>

<p>如果一开始储存 df 的时候用 index=True，会发现加载完后的 df2 是以下的样子。</p>

<p><img src="https://pic.liesio.com/2020/05/26/3eca9de45c1f9.png" alt="" /></p>

<p>df2 里面第一栏是 df 的 index，由于没有具体的 columns 名称，系统给它一个 “Unamed: 0”。因此在存储 df 的时候，如果 df.index 没有特意设定，记住要在 to_csv() 中把 index 设置为 False。</p>

<h2 id="3-数据表的索引和切片">3 数据表的索引和切片</h2>

<p>由于索引/切片 Series 跟 numpy 数组很类似，因此本节只专注于对 DataFrame 做索引和切片。本节以下面 df 为例做展示。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">symbol</span> <span class="o">=</span> <span class="p">[</span><span class="s">'BABA'</span><span class="p">,</span> <span class="s">'JD'</span><span class="p">,</span> <span class="s">'AAPL'</span><span class="p">,</span> <span class="s">'MS'</span><span class="p">,</span> <span class="s">'GS'</span><span class="p">,</span> <span class="s">'WMT'</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'行业'</span><span class="p">:</span> <span class="p">[</span><span class="s">'电商'</span><span class="p">,</span> <span class="s">'电商'</span><span class="p">,</span> <span class="s">'科技'</span><span class="p">,</span> <span class="s">'金融'</span><span class="p">,</span> <span class="s">'金融'</span><span class="p">,</span> <span class="s">'零售'</span><span class="p">],</span>
        <span class="s">'价格'</span><span class="p">:</span> <span class="p">[</span><span class="mf">176.92</span><span class="p">,</span> <span class="mf">25.95</span><span class="p">,</span> <span class="mf">172.97</span><span class="p">,</span> <span class="mf">41.79</span><span class="p">,</span> <span class="mf">196.00</span><span class="p">,</span> <span class="mf">99.55</span><span class="p">],</span>
        <span class="s">'交易量'</span><span class="p">:</span> <span class="p">[</span><span class="mi">16175610</span><span class="p">,</span> <span class="mi">27113291</span><span class="p">,</span> <span class="mi">18913154</span><span class="p">,</span> <span class="mi">10132145</span><span class="p">,</span> <span class="mi">2626634</span><span class="p">,</span> <span class="mi">8086946</span><span class="p">],</span>
        <span class="s">'雇员'</span><span class="p">:</span> <span class="p">[</span><span class="mi">101550</span><span class="p">,</span> <span class="mi">175336</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">60348</span><span class="p">,</span> <span class="mi">36600</span><span class="p">,</span> <span class="mi">2200000</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">symbol</span> <span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s">'美股'</span>
<span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'代号'</span>
<span class="n">df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>零售</td>
      <td>99.55</td>
      <td>8086946</td>
      <td>2200000</td>
    </tr>
  </tbody>
</table>
</div>

<p>用不同颜色标注了 df 的 index, columns 和 values，可视图如下：</p>

<p><img src="https://pic.liesio.com/2020/05/26/9b422a3f79704.png" alt="" /></p>

<p>DataFrame 的索引或切片可以基于标签 (label-based) ，也可以基于位置 (position-based)，不像 numpy 数组的索引或切片只基于位置。</p>

<p>DataFrame 的索引或切片有四大类：</p>

<ul>
  <li>
    <p>索引单元素：</p>

    <ul>
      <li>
        <p>基于标签的 at</p>
      </li>
      <li>
        <p>基于位置的 iat</p>
      </li>
    </ul>
  </li>
  <li>
    <p>切片 columns：</p>

    <ul>
      <li>
        <p>用 . 来切片单列</p>
      </li>
      <li>
        <p>用 [] 来切片单列或多列</p>
      </li>
      <li>
        <p>基于标签的 loc</p>
      </li>
      <li>
        <p>基于位置的 iloc</p>
      </li>
    </ul>
  </li>
  <li>
    <p>切片 index：</p>

    <ul>
      <li>
        <p>用 [] 来切片单行或多行</p>
      </li>
      <li>
        <p>基于标签的 loc</p>
      </li>
      <li>
        <p>基于位置的 iloc</p>
      </li>
    </ul>
  </li>
  <li>
    <p>切片 index 和 columns：</p>

    <ul>
      <li>
        <p>基于标签的 loc</p>
      </li>
      <li>
        <p>基于位置的 iloc</p>
      </li>
    </ul>
  </li>
</ul>

<p>总体规律，基于标签就用 at 和 loc，基于位置就用 iat 和 iloc。下面来一类类分析：</p>

<h3 id="31-索引单元素">3.1 索引单元素</h3>

<p>两种方法来索引单元素，情况 1 基于标签 at，情况 2 基于位置 iat。</p>

<ul>
  <li>
    <p>情况 1 - df.at[‘idx_i’, ‘attr_j’]</p>
  </li>
  <li>
    <p>情况 2 - df.iat[i, j]</p>
  </li>
</ul>

<p>Python 里的中括号 [] 会代表很多意思，比如单元素索引，多元素切片，布尔索引等等，因此让 Python 猜你用的 [] 意图会很低效。如果想索引单元素，明明白白的用 at 和 iat 效率最高。</p>

<font color="red"><b>情况 1</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">at</span><span class="p">[</span><span class="s">'AAPL'</span><span class="p">,</span><span class="s">'价格'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>172.97
</code></pre></div></div>

<p>用 at 获取「行<strong>标签</strong>」为 ‘AAPL’ 和「列<strong>标签</strong>」为 ‘价格’ 对应的元素。</p>

<font color="red"><b>情况 2</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>172.97
</code></pre></div></div>

<p>用 iat 获取第 3 行第 2 列对应的元素。</p>

<p>索引单元素的总结图：</p>

<p><img src="https://pic.liesio.com/2020/05/26/7d784cf504914.png" alt="" /></p>

<h3 id="32-切片-columns">3.2 切片 columns</h3>

<h4 id="切片单个-columns">切片单个 columns</h4>

<p>切片单个 columns 会返回一个 Series，有以下四种情况。情况 1 用点 .；情况 2 用中括号 []；情况 3 基于标签 loc，情况 4 基于位置 iloc。</p>

<ul>
  <li>
    <p>情况 1 - df.attr_i</p>
  </li>
  <li>
    <p>情况 2 - df[‘attr_i’]</p>
  </li>
  <li>
    <p>情况 3 - df.loc[:, ‘attr_i’]</p>
  </li>
  <li>
    <p>情况 4 - df.iloc[:, i]</p>
  </li>
</ul>

<p>情况 1 记住就可以了，没什么可说的。</p>

<p>情况 2 非常像二维 numpy 数组 arr 的切片，用 arr[i] 就能获取 arr 在「轴 0」上的第 i 个元素 (一个 1darray)，同理 df[‘attr_i’] 也能获取 df 的第 i 个 Series。</p>

<p>情况 3 和 4 的 loc 和 iloc 可类比于上面的 at 和 iat。带 i 的基于位置 (位置用整数表示，i 也泛指整数)，不带 i 的基于标签。<strong>里面的冒号 : 代表所有的 index</strong> (和 numpy 数组里的冒号意思相同)。</p>

<p><strong>个人建议，如果追求简洁和方便，用 . 和 []；如果追求一致和清晰，用 loc 和 iloc。</strong></p>

<font color="red"><b>情况 1</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">价格</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>代号
BABA    176.92
JD       25.95
AAPL    172.97
MS       41.79
GS      196.00
WMT      99.55
Name: 价格, dtype: float64
</code></pre></div></div>

<p>用 . 获取「价格」那一栏下的 Series。</p>

<font color="red"><b>情况 2</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'价格'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>代号
BABA    176.92
JD       25.95
AAPL    172.97
MS       41.79
GS      196.00
WMT      99.55
Name: 价格, dtype: float64
</code></pre></div></div>

<p>用 [] 获取「价格」属性下的 Series。</p>

<font color="red"><b>情况 3</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s">'交易量'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>代号
BABA    16175610
JD      27113291
AAPL    18913154
MS      10132145
GS       2626634
WMT      8086946
Name: 交易量, dtype: int64
</code></pre></div></div>

<p>用 loc 获取「交易量」属性下的 Series。</p>

<font color="red"><b>情况 4</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>代号
BABA    电商
JD      电商
AAPL    科技
MS      金融
GS      金融
WMT     零售
Name: 行业, dtype: object
</code></pre></div></div>

<p>用 iloc 获取第 1 列下的 Series。</p>

<p>切片单个 columns 的总结图：</p>

<p><img src="https://pic.liesio.com/2020/05/26/e3f474b921c59.png" alt="" /></p>

<h4 id="切片多个-columns">切片多个 columns</h4>

<p>切片多个 columns 会返回一个 sub-DataFrame (原 DataFrame 的子集)，有以下三种情况。情况 1 用中括号 []；情况 2 基于标签 loc，情况 3 基于位置 iloc。</p>

<ul>
  <li>
    <p>情况 1 - df[[‘attr_i’, ‘attr_j’]]</p>
  </li>
  <li>
    <p>情况 2 - df.loc[:, ‘attr_i’:’attr_j’]</p>
  </li>
  <li>
    <p>情况 3 - df.iloc[:, i:j]</p>
  </li>
</ul>

<p>和切片单个 columns 相比：</p>

<ul>
  <li>
    <p>情况 1 用一个列表来储存一组属性 ‘attr_i’, ‘attr_j’，然后在放进中括号 [] 里获取它们</p>
  </li>
  <li>
    <p>情况 2 用 ‘attr_i’:’attr_j’ 来获取从属性 i 到属性 j 的 sub-DataFrame</p>
  </li>
  <li>
    <p>情况 3 用 i:j 来获取从列 i+1 到列 j 的 sub-DataFrame</p>
  </li>
</ul>

<p><strong>个人建议，如果追求简洁和方便，用 []；如果追求一致和清晰，用 loc 和 iloc。</strong></p>

<font color="red"><b>情况 1</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span> <span class="p">[</span><span class="s">'雇员'</span><span class="p">,</span> <span class="s">'价格'</span><span class="p">]</span> <span class="p">]</span><span class="c1">#两个中括号
</span></code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>雇员</th>
      <th>价格</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>101550</td>
      <td>176.92</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>175336</td>
      <td>25.95</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>100000</td>
      <td>172.97</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>60348</td>
      <td>41.79</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>36600</td>
      <td>196.00</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>2200000</td>
      <td>99.55</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 [] 获取「雇员」和「价格」两个属性下的 sub-DataFrame。</p>

<font color="red"><b>情况 2</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s">'行业'</span><span class="p">:</span><span class="s">'交易量'</span><span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>零售</td>
      <td>99.55</td>
      <td>8086946</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 loc 获取从属性 ‘行业’ 到 ‘交易量‘ 的 sub-DataFrame。</p>

<font color="red"><b>情况 3</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>金融</td>
      <td>196.00</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>零售</td>
      <td>99.55</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 iloc 获取第 1 和 2 列下的 sub-DataFrame。</p>

<p>切片多个 columns 的总结图：</p>

<p><img src="https://pic.liesio.com/2020/05/26/d026a7eac4407.png" alt="" /></p>

<h3 id="33-切片-index">3.3 切片 index</h3>

<h4 id="切片单个-index">切片单个 index</h4>

<p>切片单个 index 有时会返回一个 Series，有以下两种情况。情况 1 基于标签 loc，情况 2 基于位置 iloc。</p>

<ul>
  <li>
    <p>情况 1 - df.loc[‘idx_i’, :]</p>
  </li>
  <li>
    <p>情况 2 - df.iloc[i, :]</p>
  </li>
</ul>

<p>切片单个 index 有时会返回一个只有一行的 DataFrame，有以下两种情况。情况 3 用中括号 [] 加「位置」，情况 4 用中括号 [] 加「标签」。</p>

<ul>
  <li>
    <p>情况 3 - df[i:i+1]</p>
  </li>
  <li>
    <p>情况 4 - df[‘idx_i’:’idx_i’]</p>
  </li>
</ul>

<p>情况 1 和 2 的 loc 和 iloc 可类比于上面的 at 和 iat。带 i 的基于位置 (位置用整数表示，i 也泛指整数)，不带 i 的基于标签。里面的冒号 : 代表所有的 columns (和 numpy 数组里的冒号意思相同)。</p>

<p>情况 3 用中括号 [] 加「位置」，位置 i:i+1 有前闭后开的性质。如果要获取第 i+1 行，需要用 i:i+1。</p>

<p>情况 4 用中括号 [] 加「标签」，标签没有前闭后开的性质。如果要获取标签 i，只需要用 ‘idx_i’:’idx_i’。为什么不能只用 ‘idx_i’ 呢？原因是 Python 会把 df[‘idx_i’] 当成切片 columns，然后发现属性中没有 ‘idx_i’ 这一个字符，会报错的。</p>

<p><strong>个人建议，只用 loc 和 iloc。情况 3 太麻烦，获取一行还要用 i:i+1。情况 4 的 df[‘idx_i’] 很容易和切片 columns 中的语句 df[‘attr_j’] 混淆。</strong></p>

<font color="red"><b>情况 1</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span> <span class="s">'GS'</span><span class="p">,</span> <span class="p">:</span> <span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>行业          金融
价格         196
交易量    2626634
雇员       36600
Name: GS, dtype: object
</code></pre></div></div>

<p>用 loc 获取标签为 ‘GS‘ 的 Series。(GS = Goldman Sachs = 高盛)</p>

<font color="red"><b>情况 2</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:</span> <span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>行业           金融
价格        41.79
交易量    10132145
雇员        60348
Name: MS, dtype: object
</code></pre></div></div>

<p>用 iloc 获取第 4 行下的 Series。(MS = Morgan Stanley = 摩根斯坦利)</p>

<font color="red"><b>情况 3</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 [1:2] 获取第 2 行的 sub-DataFrame (只有一行)。</p>

<font color="red"><b>情况 4</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'JD'</span><span class="p">:</span><span class="s">'JD'</span><span class="p">]</span><span class="c1">#一个头一个尾
</span></code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'JD'</span><span class="p">:</span><span class="s">'MS'</span><span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 [‘JD’:’JD’] 获取标签为 ‘JD’ 的 sub-DataFrame (只有一行)。</p>

<p>切片单个 index 的总结图：</p>

<p><img src="https://pic.liesio.com/2020/05/26/3acf11f0a3ba5.png" alt="" /></p>

<h4 id="切片多个-index">切片多个 index</h4>

<p>切片多个 index 会返回一个 sub-DataFrame，有以下四种情况。情况 1 用中括号 [] 加「位置」，情况 2 用中括号 [] 加「标签」，情况 3 基于标签 loc，情况 4 基于位置 iloc。</p>

<ul>
  <li>
    <p>情况 1 - df[i:j]</p>
  </li>
  <li>
    <p>情况 2 - df[‘idx_i’:’idx_j’]</p>
  </li>
  <li>
    <p>情况 3 - df.loc[‘idx_i’:’idx_j’, :]</p>
  </li>
  <li>
    <p>情况 4 - df.iloc[i:j, :]</p>
  </li>
</ul>

<p>和切片单个 index 相比：</p>

<ul>
  <li>
    <p>情况 1 用 [i:j] 来获取行 i+1 到行 j 的 sub-DataFrame</p>
  </li>
  <li>
    <p>情况 2 用 [‘idx_i’:’idx_j’] 来获取标签 i 到标签 j 的 sub-DataFrame</p>
  </li>
  <li>
    <p>情况 3 用 loc 加 ‘idx_i’:’idx_j’ 来获取从标签 i 到标签 j 的 sub-DataFrame</p>
  </li>
  <li>
    <p>情况 4 用 iloc 加 i:j 来获取从行 i+1 到行 j 的 sub-DataFrame</p>
  </li>
</ul>

<p><strong>个人建议，只用 loc 和 iloc。情况 1 和 2 的 df[] 很容易混淆中括号 [] 里的到底是切片 index 还是 columns。</strong></p>

<font color="red"><b>情况 1</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span> <span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 [1:4] 获取第 2 到 4 行的 sub-DataFrame。</p>

<font color="red"><b>情况 2</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span> <span class="s">'GS'</span><span class="p">:</span><span class="s">'WMT'</span> <span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GS</th>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>零售</td>
      <td>99.55</td>
      <td>8086946</td>
      <td>2200000</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 [‘GS’:’WMT’] 获取标签从’GS’ 到 ‘WMT’ 的 sub-DataFrame。(WMT = Walmart = 沃尔玛)</p>

<font color="red"><b>情况 3</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span> <span class="s">'MS'</span><span class="p">:</span><span class="s">'GS'</span><span class="p">,</span> <span class="p">:</span> <span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 loc 获取标签从 ‘MS‘ 到 ‘GS’ 的 sub-DataFrame。注意 ‘MS’:’GS’ 要按着 index 里面元素的顺序，要不然会返回一个空的 DataFrame，比如：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span> <span class="s">'MS'</span><span class="p">:</span><span class="s">'JD'</span><span class="p">,</span> <span class="p">:</span> <span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>

<font color="red"><b>情况 4</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span> <span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 iloc 获取第 2 到 3 行的 sub-DataFrame。</p>

<p>切片多个 index 的总结图：</p>

<p><img src="https://pic.liesio.com/2020/05/26/44a00de3aa5c3.png" alt="" /></p>

<h3 id="34-切片-index-和-columns">3.4 切片 index 和 columns</h3>

<p>切片多个 index 和 columns 会返回一个 sub-DataFrame，有以下两种情况。情况 1 基于标签 loc，情况 2 基于位置 iloc。</p>

<ul>
  <li>
    <p>情况 1 - df.loc[‘idx_i’:’idx_j’, ‘attr_k’:’attr_l’]</p>
  </li>
  <li>
    <p>情况 2 - df.iloc[i:j, k:l]</p>
  </li>
</ul>

<p>清清楚楚，明明白白，用 loc 和 iloc。</p>

<font color="red"><b>情况 1</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span> <span class="s">'GS'</span><span class="p">:</span><span class="s">'WMT'</span><span class="p">,</span> <span class="s">'价格'</span><span class="p">:</span> <span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GS</th>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>99.55</td>
      <td>8086946</td>
      <td>2200000</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 loc 获取行标签从 ‘GS‘ 到 ‘WMT’，列标签从’价格’到最后的 sub-DataFrame。</p>

<font color="red"><b>情况 2</b></font>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span> <span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span> <span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>价格</th>
      <th>交易量</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>176.92</td>
      <td>16175610</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>25.95</td>
      <td>27113291</td>
    </tr>
  </tbody>
</table>
</div>

<p>用 iloc 获取第 1 到 2 行，第 1 到 2 列的 sub-DataFrame。</p>

<p>切片 index 和 columns 的总结图：</p>

<p><img src="https://pic.liesio.com/2020/05/26/e6c91c5773f9f.png" alt="" /></p>

<h3 id="35-高级索引">3.5 高级索引</h3>

<p>高级索引 (advanced indexing) 可以用布尔索引 (boolean indexing) 和调用函数 (callable function) 来实现，两种方法都返回一组“正确”的索引，而且可以和 loc , iloc , [] 一起套用，具体形式有以下常见几种：</p>

<ul>
  <li>
    <p>df.loc[布尔索引, :]</p>
  </li>
  <li>
    <p>df.iloc[布尔索引, :]</p>
  </li>
  <li>
    <p>df[布尔索引]</p>
  </li>
  <li>
    <p>df.loc[调用函数, :]</p>
  </li>
  <li>
    <p>df.iloc[调用函数, :]</p>
  </li>
  <li>
    <p>df[调用函数]</p>
  </li>
</ul>

<p>还有以下罕见几种：</p>

<ul>
  <li>
    <p>df.loc[:, 布尔索引]</p>
  </li>
  <li>
    <p>df.iloc[:, 布尔索引]</p>
  </li>
  <li>
    <p>df.loc[:, 调用函数]</p>
  </li>
  <li>
    <p>df.iloc[:, 调用函数]</p>
  </li>
</ul>

<p>读者可以想一想为什么第一组形式「常见」而第二组形式「罕见」呢？(<strong>Hint: 看看两组里冒号 : 在不同位置，再想想 DataFrame 每一行和每一列中数据的特点</strong>)</p>

<h4 id="布尔索引">布尔索引</h4>

<p>在〖数组计算之 NumPy (上)〗提过，布尔索引就是用一个由布尔类型值组成的数组来选择元素的方法。</p>

<p>当要过滤掉雇员小于 100,000 人的公司，可以用 loc 加上布尔索引。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span> <span class="n">df</span><span class="p">.</span><span class="n">雇员</span> <span class="o">&gt;=</span> <span class="mi">100000</span> <span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span> <span class="n">df</span><span class="p">.</span><span class="n">雇员</span> <span class="o">&gt;=</span> <span class="mi">100000</span><span class="p">,</span> <span class="p">:</span> <span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>代号
BABA     True
JD       True
AAPL     True
MS      False
GS      False
WMT      True
Name: 雇员, dtype: bool
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>零售</td>
      <td>99.55</td>
      <td>8086946</td>
      <td>2200000</td>
    </tr>
  </tbody>
</table>
</div>

<p>一种更简便的表达形式是用 df[]，但是个人不喜欢 []，总觉得会引起「到底在切片 index 还是 columns」的歧义。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="p">.</span><span class="n">雇员</span> <span class="o">&gt;=</span> <span class="mi">100000</span> <span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>零售</td>
      <td>99.55</td>
      <td>8086946</td>
      <td>2200000</td>
    </tr>
  </tbody>
</table>
</div>

<p>现在来看一个「罕见」例子，假如想找到所有值为整数型的 columns</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span> <span class="n">df</span><span class="p">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="s">'int64'</span> <span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">:,</span> <span class="n">df</span><span class="p">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="s">'int64'</span> <span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>行业     False
价格     False
交易量     True
雇员      True
dtype: bool
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>18913154</td>
      <td>100000</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>10132145</td>
      <td>60348</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>2626634</td>
      <td>36600</td>
    </tr>
    <tr>
      <th>WMT</th>
      <td>8086946</td>
      <td>2200000</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="调用函数">调用函数</h4>

<p>调用函数是只能有一个参数 (DataFrame, Series) 并返回一组索引的函数。因为调用函数定义在 loc , iloc , [] 里面，因此它就像在〖Python编程基础〗提过的匿名函数。</p>

<p>当要找出交易量大于平均交易量的所有公司，可以用 loc 加上匿名函数 (这里 x 代表 df)。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">交易量</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">交易量</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span> <span class="p">,</span> <span class="p">:</span> <span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
  </tbody>
</table>
</div>

<p>在上面基础上再加一个条件 – 价格要在 100 之上 (这里 x 还是代表 df)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">交易量</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">交易量</span><span class="p">.</span><span class="n">mean</span><span class="p">())</span> 
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">价格</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">),</span> <span class="p">:</span> <span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>科技</td>
      <td>172.97</td>
      <td>18913154</td>
      <td>100000</td>
    </tr>
  </tbody>
</table>
</div>

<p>最后来看看价格大于 100 的股票 (注意这里 x 代表 df.价格)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">价格</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>代号
BABA    176.92
AAPL    172.97
GS      196.00
Name: 价格, dtype: float64
</code></pre></div></div>

<h3 id="36-多层索引">3.6 多层索引</h3>

<p>层次化索引（hierarchical indexing）也叫多层索引，是pandas的一项重要功能，它使你能在一个轴上拥有多个（两个以上）索引级别。多层索引可以将「低维数据」升维到「高维数据」。抽象点说，它使你能以低维度形式处理高维度数据。</p>

<h4 id="多层索引-series">多层索引 Series</h4>

<p>首先定义一个 Series，注意它的 index 是一个二维列表，列表第一行 dates 作为第一层索引，第二行 codes 作为第二层索引。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">price</span> <span class="o">=</span> <span class="p">[</span><span class="mi">190</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">196</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">189</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">199</span><span class="p">]</span>
<span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="s">'2019-04-01'</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s">'2019-04-02'</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="p">[</span><span class="s">'2019-04-03'</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s">'2019-04-04'</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s">'BABA'</span><span class="p">,</span><span class="s">'JD'</span><span class="p">,</span><span class="s">'GS'</span><span class="p">,</span><span class="s">'BABA'</span><span class="p">,</span><span class="s">'GS'</span><span class="p">,</span><span class="s">'BABA'</span><span class="p">,</span><span class="s">'JD'</span><span class="p">,</span><span class="s">'JD'</span><span class="p">,</span><span class="s">'GS'</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span> <span class="n">price</span><span class="p">,</span>
                  <span class="n">index</span><span class="o">=</span><span class="p">[</span> <span class="n">dates</span><span class="p">,</span> <span class="n">codes</span> <span class="p">])</span>
<span class="n">data</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-04-01  BABA    190
            JD       32
            GS      196
2019-04-02  BABA    192
            GS      200
2019-04-03  BABA    189
            JD       31
2019-04-04  JD       30
            GS      199
dtype: int64
</code></pre></div></div>

<p>这个 Series 存储了四天里若干股票的价格，2019-04-01 储存了阿里巴巴、京东和高盛的股价，2019-04-04 只储存了京东和高盛的股价。试想，如果不用多层索引的 Series，则需要用一个 DataFrame 来存储在这样的数据，把 index 设置成 dates，把 colums 设置成 codes。</p>

<p>来看看 Series 的多层 index 是如何表示的</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">.</span><span class="n">index</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MultiIndex([('2019-04-01', 'BABA'),
            ('2019-04-01',   'JD'),
            ('2019-04-01',   'GS'),
            ('2019-04-02', 'BABA'),
            ('2019-04-02',   'GS'),
            ('2019-04-03', 'BABA'),
            ('2019-04-03',   'JD'),
            ('2019-04-04',   'JD'),
            ('2019-04-04',   'GS')],
           )
</code></pre></div></div>

<p>输出是一个 MultiIndex 的对象，里面有 levels 和 labels 二类信息。</p>

<font color="red"><b>知识点</b></font>

<p>索引既然分多层，那么肯定分「内层」和「外层」把，levels 就是描述层的先后的。levels 是一个二维列表，每一行只存储着「唯一」的索引信息：</p>

<ul>
  <li>
    <p>dates 是第一层索引，有 4 个「唯一」元素</p>
  </li>
  <li>
    <p>codes 是第二层索引，有 3 个「唯一」元素</p>
  </li>
</ul>

<p>但是 data 里面有九行啊，4 个 dates 和 3 个 codes 怎么能描述这九行信息呢？这就需要 labels 了。labels 也是一个二维列表：</p>

<ul>
  <li>
    <p>第一行储存 dates 每个元素在 data 里的位置索引</p>
  </li>
  <li>
    <p>第二行储存 codes 每个元素在 data 里的位置索引</p>
  </li>
</ul>

<p>用 [] 加第一层索引可以获取第一层信息。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">[</span><span class="s">'2019-04-02'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BABA    192
GS      200
dtype: int64
</code></pre></div></div>

<p>同理，用 loc 加第一层索引也可以切片获取第一层信息。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'2019-04-02'</span><span class="p">:</span><span class="s">'2019-04-04'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-04-02  BABA    192
            GS      200
2019-04-03  BABA    189
            JD       31
2019-04-04  JD       30
            GS      199
dtype: int64
</code></pre></div></div>

<p>此外，切片还可以在不同层上进行，下面 loc  中的冒号 : 表示第一层所有元素，‘GS’ 表示第二层标签为 ‘GS’。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">:,</span> <span class="s">'GS'</span> <span class="p">]</span><span class="c1">#[第一层索引，第二层索引]
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-04-01    196
2019-04-02    200
2019-04-04    199
dtype: int64
</code></pre></div></div>

<h4 id="多层索引-dataframe">多层索引 DataFrame</h4>

<p>Series 只有 index，上面刚介绍完多层 index，DataFrame 有 index 和 columns，它们可以设置成多层吗？下面代码用 MultiIndex 函数创建「多层 index 」midx 和「多层columns」mcol。</p>

<p>midx 和 mcol 都是对象，各种都有 levels, labels, names 等性质。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s">'电商'</span><span class="p">,</span> <span class="mi">101550</span><span class="p">,</span> <span class="mf">176.92</span><span class="p">,</span> <span class="mi">16175610</span><span class="p">],</span> 
         <span class="p">[</span><span class="s">'电商'</span><span class="p">,</span> <span class="mi">175336</span><span class="p">,</span> <span class="mf">25.95</span><span class="p">,</span> <span class="mi">27113291</span><span class="p">],</span> 
         <span class="p">[</span><span class="s">'金融'</span><span class="p">,</span> <span class="mi">60348</span><span class="p">,</span> <span class="mf">41.79</span><span class="p">,</span> <span class="mi">10132145</span><span class="p">],</span> 
         <span class="p">[</span><span class="s">'金融'</span><span class="p">,</span> <span class="mi">36600</span><span class="p">,</span> <span class="mf">196.00</span><span class="p">,</span> <span class="mi">2626634</span><span class="p">]</span> <span class="p">]</span>

<span class="n">midx</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">MultiIndex</span><span class="p">(</span> 
          <span class="n">levels</span><span class="o">=</span><span class="p">[[</span><span class="s">'中国'</span><span class="p">,</span><span class="s">'美国'</span><span class="p">],</span>
                  <span class="p">[</span><span class="s">'BABA'</span><span class="p">,</span> <span class="s">'JD'</span><span class="p">,</span> <span class="s">'GS'</span><span class="p">,</span> <span class="s">'MS'</span><span class="p">]],</span> 
          <span class="n">codes</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
          <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">'地区'</span><span class="p">,</span> <span class="s">'代号'</span><span class="p">])</span>
<span class="c1">#codes是levals的排序
</span><span class="n">mcol</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">MultiIndex</span><span class="p">(</span> 
          <span class="n">levels</span><span class="o">=</span><span class="p">[[</span><span class="s">'公司数据'</span><span class="p">,</span><span class="s">'交易数据'</span><span class="p">],</span>
                  <span class="p">[</span><span class="s">'行业'</span><span class="p">,</span><span class="s">'雇员'</span><span class="p">,</span><span class="s">'价格'</span><span class="p">,</span><span class="s">'交易量'</span><span class="p">]],</span> 
          <span class="n">codes</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
          <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">'概括'</span><span class="p">,</span><span class="s">'细分'</span><span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">midx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">mcol</span><span class="p">)</span>
<span class="n">df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>概括</th>
      <th colspan="2" halign="left">公司数据</th>
      <th colspan="2" halign="left">交易数据</th>
    </tr>
    <tr>
      <th></th>
      <th>细分</th>
      <th>行业</th>
      <th>雇员</th>
      <th>价格</th>
      <th>交易量</th>
    </tr>
    <tr>
      <th>地区</th>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">中国</th>
      <th>BABA</th>
      <td>电商</td>
      <td>101550</td>
      <td>176.92</td>
      <td>16175610</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>175336</td>
      <td>25.95</td>
      <td>27113291</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">美国</th>
      <th>GS</th>
      <td>金融</td>
      <td>60348</td>
      <td>41.79</td>
      <td>10132145</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>36600</td>
      <td>196.00</td>
      <td>2626634</td>
    </tr>
  </tbody>
</table>
</div>

<p>这个 DataFrame 的 index 和 columns 都有两层，严格来说是个四维数据。下面看看如何进行「多层索引」的操作吧。</p>

<p>在第一层 columns 的 ‘公司数据’ 和第二层 columns 的 ‘行业’ 做索引，得到一个含两层 index 的 Series。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1st level-1 column, 2nd level-2 column
</span><span class="n">df</span><span class="p">[</span><span class="s">'公司数据'</span><span class="p">,</span><span class="s">'行业'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>地区  代号  
中国  BABA    电商
    JD      电商
美国  GS      金融
    MS      金融
Name: (公司数据, 行业), dtype: object
</code></pre></div></div>

<p>在第一层 index 的 ‘中国’ 做切片，得到一个含两层 columns 的 DataFrame。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'中国'</span><span class="p">].</span><span class="n">loc</span><span class="p">[</span><span class="s">'BABA'</span><span class="p">:</span><span class="s">'JD'</span><span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>概括</th>
      <th colspan="2" halign="left">公司数据</th>
      <th colspan="2" halign="left">交易数据</th>
    </tr>
    <tr>
      <th>细分</th>
      <th>行业</th>
      <th>雇员</th>
      <th>价格</th>
      <th>交易量</th>
    </tr>
    <tr>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <td>电商</td>
      <td>101550</td>
      <td>176.92</td>
      <td>16175610</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>175336</td>
      <td>25.95</td>
      <td>27113291</td>
    </tr>
  </tbody>
</table>
</div>

<font color="red"><b>调位 level</b></font>

<p>如果不喜欢 index level 的顺序，可用 swaplevel 将它们调位。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="s">'地区'</span><span class="p">,</span> <span class="s">'代号'</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>概括</th>
      <th colspan="2" halign="left">公司数据</th>
      <th colspan="2" halign="left">交易数据</th>
    </tr>
    <tr>
      <th></th>
      <th>细分</th>
      <th>行业</th>
      <th>雇员</th>
      <th>价格</th>
      <th>交易量</th>
    </tr>
    <tr>
      <th>代号</th>
      <th>地区</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BABA</th>
      <th>中国</th>
      <td>电商</td>
      <td>101550</td>
      <td>176.92</td>
      <td>16175610</td>
    </tr>
    <tr>
      <th>JD</th>
      <th>中国</th>
      <td>电商</td>
      <td>175336</td>
      <td>25.95</td>
      <td>27113291</td>
    </tr>
    <tr>
      <th>GS</th>
      <th>美国</th>
      <td>金融</td>
      <td>60348</td>
      <td>41.79</td>
      <td>10132145</td>
    </tr>
    <tr>
      <th>MS</th>
      <th>美国</th>
      <td>金融</td>
      <td>36600</td>
      <td>196.00</td>
      <td>2626634</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>概括</th>
      <th colspan="2" halign="left">公司数据</th>
      <th colspan="2" halign="left">交易数据</th>
    </tr>
    <tr>
      <th></th>
      <th>细分</th>
      <th>行业</th>
      <th>雇员</th>
      <th>价格</th>
      <th>交易量</th>
    </tr>
    <tr>
      <th>地区</th>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">中国</th>
      <th>BABA</th>
      <td>电商</td>
      <td>101550</td>
      <td>176.92</td>
      <td>16175610</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>175336</td>
      <td>25.95</td>
      <td>27113291</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">美国</th>
      <th>GS</th>
      <td>金融</td>
      <td>60348</td>
      <td>41.79</td>
      <td>10132145</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>36600</td>
      <td>196.00</td>
      <td>2626634</td>
    </tr>
  </tbody>
</table>
</div>

<p>如果不喜欢 columns level 的顺序，也可用 swaplevel 将它们调位。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>细分</th>
      <th>行业</th>
      <th>雇员</th>
      <th>价格</th>
      <th>交易量</th>
    </tr>
    <tr>
      <th></th>
      <th>概括</th>
      <th>公司数据</th>
      <th>公司数据</th>
      <th>交易数据</th>
      <th>交易数据</th>
    </tr>
    <tr>
      <th>地区</th>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">中国</th>
      <th>BABA</th>
      <td>电商</td>
      <td>101550</td>
      <td>176.92</td>
      <td>16175610</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>175336</td>
      <td>25.95</td>
      <td>27113291</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">美国</th>
      <th>GS</th>
      <td>金融</td>
      <td>60348</td>
      <td>41.79</td>
      <td>10132145</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>金融</td>
      <td>36600</td>
      <td>196.00</td>
      <td>2626634</td>
    </tr>
  </tbody>
</table>
</div>

<font color="red"><b>重设 index</b></font>

<p>有时候，一个 DataFrame 的一个或者多个 columns 适合做 index，这时可用 set_index 将它们设置为 index，如果要将 index 还原成 columns，那么用 reset_index 。</p>

<p>看下面这个例子。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'地区'</span><span class="p">:</span> <span class="p">[</span><span class="s">'中国'</span><span class="p">,</span> <span class="s">'中国'</span><span class="p">,</span> <span class="s">'美国'</span><span class="p">,</span> <span class="s">'美国'</span><span class="p">],</span>
        <span class="s">'代号'</span><span class="p">:</span> <span class="p">[</span><span class="s">'BABA'</span><span class="p">,</span> <span class="s">'JD'</span><span class="p">,</span> <span class="s">'MS'</span><span class="p">,</span> <span class="s">'GS'</span><span class="p">],</span>
        <span class="s">'行业'</span><span class="p">:</span> <span class="p">[</span><span class="s">'电商'</span><span class="p">,</span> <span class="s">'电商'</span><span class="p">,</span> <span class="s">'金融'</span><span class="p">,</span> <span class="s">'金融'</span><span class="p">],</span>
        <span class="s">'价格'</span><span class="p">:</span> <span class="p">[</span><span class="mf">176.92</span><span class="p">,</span> <span class="mf">25.95</span><span class="p">,</span> <span class="mf">41.79</span><span class="p">,</span> <span class="mf">196.00</span><span class="p">],</span>
        <span class="s">'交易量'</span><span class="p">:</span> <span class="p">[</span><span class="mi">16175610</span><span class="p">,</span> <span class="mi">27113291</span><span class="p">,</span> <span class="mi">10132145</span><span class="p">,</span> <span class="mi">2626634</span><span class="p">],</span>
        <span class="s">'雇员'</span><span class="p">:</span> <span class="p">[</span><span class="mi">101550</span><span class="p">,</span> <span class="mi">175336</span><span class="p">,</span> <span class="mi">60348</span><span class="p">,</span> <span class="mi">36600</span><span class="p">]</span> <span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
<span class="n">df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地区</th>
      <th>代号</th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>中国</td>
      <td>BABA</td>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>1</th>
      <td>中国</td>
      <td>JD</td>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>2</th>
      <td>美国</td>
      <td>MS</td>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
    <tr>
      <th>3</th>
      <td>美国</td>
      <td>GS</td>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
  </tbody>
</table>
</div>

<p>将「地区」和「代号」设置为第一层 index 和第二层 index。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span> <span class="p">[</span><span class="s">'地区'</span><span class="p">,</span><span class="s">'代号'</span><span class="p">]</span> <span class="p">)</span>
<span class="n">df2</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
    <tr>
      <th>地区</th>
      <th>代号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">中国</th>
      <th>BABA</th>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>JD</th>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">美国</th>
      <th>MS</th>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
    <tr>
      <th>GS</th>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>将所有 index 变成 columns。</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span><span class="p">.</span><span class="n">reset_index</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地区</th>
      <th>代号</th>
      <th>行业</th>
      <th>价格</th>
      <th>交易量</th>
      <th>雇员</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>中国</td>
      <td>BABA</td>
      <td>电商</td>
      <td>176.92</td>
      <td>16175610</td>
      <td>101550</td>
    </tr>
    <tr>
      <th>1</th>
      <td>中国</td>
      <td>JD</td>
      <td>电商</td>
      <td>25.95</td>
      <td>27113291</td>
      <td>175336</td>
    </tr>
    <tr>
      <th>2</th>
      <td>美国</td>
      <td>MS</td>
      <td>金融</td>
      <td>41.79</td>
      <td>10132145</td>
      <td>60348</td>
    </tr>
    <tr>
      <th>3</th>
      <td>美国</td>
      <td>GS</td>
      <td>金融</td>
      <td>196.00</td>
      <td>2626634</td>
      <td>36600</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="4-总结">4 总结</h2>

<p>Pandas 里面的数据结构是多维数据表，细化为一维的 Series，二维的 DataFrame。</p>

<p><b><font color="red">pd 多维数据表 </font>= <font color="blue">np 多维数组</font> + <font color="green">描述</font></b></p>

<p>其中
<b></b></p>
<ul>
  <li>
    <font color="red">Series</font>
    <p>= <font color="blue">1darray</font> + <font color="green">index</font></p>
  </li>
  <li>
    <font color="red">DataFrame</font>
    <p>= <font color="blue">2darray</font> + <font color="green">index</font> + <font color="green">columns</font>
&lt;/b&gt;</p>
  </li>
</ul>

<p>pd 多维数据表和 np 多维数组之间的类比关系如下图所示。</p>

<p><img src="https://pic.liesio.com/2020/05/26/4e360426d986a.png" alt="" /></p>

<p>【创建数据表】创建 Series, DataFrame 用下面语句</p>

<ul>
  <li>
    <p>pd.Series(x, index=idx)</p>
  </li>
  <li>
    <p>pd.DataFrame(x, index=idx, columns=col)</p>
  </li>
</ul>

<p>DataFrame 由多个 Series 组成，而 Series 非常类似于一维的 DataFrame，因此学 Pandas 把注意力放在 DataFrame 上即可。</p>

<p>【索引和切片数据表】在索引或切片 DataFrame，有很多种方法。最好记的而不易出错的是用基于位置的 at 和 loc，和基于标签的 iat 和 iloc，具体来说，索引用 at 和 iat，切片用 loc 和 iloc。带 i 的基于位置，不带 i 的基于标签。</p>

<p><img src="https://pic.liesio.com/2020/05/26/fdd90ae2937d3.png" alt="" /></p>

<p>用 MultiIndex 可以创建多层索引的对象，获取 DataFrame df 的信息可用</p>

<ul>
  <li>
    <p>df.loc[1st].loc[2nd]</p>
  </li>
  <li>
    <p>df.loc[1st].iloc[2nd]</p>
  </li>
  <li>
    <p>df.iloc[1st].loc[2nd]</p>
  </li>
  <li>
    <p>df.iloc[1st].iloc[2nd]</p>
  </li>
</ul>

<p>要调换 level 可用</p>

<ul>
  <li>
    <p>df.index.swaplevel(0,1)</p>
  </li>
  <li>
    <p>df.columns.swaplevel(0,1)</p>
  </li>
</ul>

<p>要设置和重设 index 可用</p>

<ul>
  <li>
    <p>df.set_index( columns )</p>
  </li>
  <li>
    <p>df.reset_index</p>
  </li>
</ul>

<p>下篇讨论 Pandas 系列的后三节，分别是</p>

<ul>
  <li>
    <p>「数据表的合并和连接」</p>
  </li>
  <li>
    <p>「数据表的重塑和透视」</p>
  </li>
  <li>
    <p>「数据表的分组和整合」</p>
  </li>
</ul>

<p>Stay Tuned!</p>

<p><img src="https://pic.liesio.com/2020/05/12/f0e6dce0060f9.png" alt="结束" /></p>

    <script src="https://utteranc.es/client.js"
        repo="spiritLHL/blogtalks"
        issue-term="pathname"
        theme="github-light"  
        crossorigin="anonymous"
        async>
    </script>
    <script data-ad-client="ca-pub-8663941481627036" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  </div><a class="u-url" href="/jupyter_notebook_blogs/markdown/2020/05/26/Pandas(%E4%B8%8A).html" hidden></a>
</article>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/jupyter_notebook_blogs/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/jupyter_notebook_blogs/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/jupyter_notebook_blogs/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Personally explore Python&#39;s study notes.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/spiritLHL" title="spiritLHL"><svg class="svg-icon grey"><use xlink:href="/jupyter_notebook_blogs/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
